# Forex Edge Dashboard: Live Economic Data & Weekly COT Insights
# This code pulls live economic data, weekly COT data, and generates bullish/bearish scores for specified currency pairs.

import requests
import pandas as pd
from datetime import datetime

# --- Configuration ---
API_KEY = 'YOUR_API_KEY_HERE'  # Replace with a valid economic data API key
BASE_URL = 'https://api.example.com/economic'  # Placeholder; replace with actual API endpoint
COT_URL = 'https://api.example.com/cot'  # Placeholder; replace with actual COT data endpoint

# Currency pairs to track
currency_pairs = [
    'AUDCHF', 'AUDJPY', 'AUDUSD', 'AUDNZD', 'AUDCAD', 'EURUSD', 'EURCAD', 'EURAUD', 'EURJPY', 'EURNZD',
    'EURGBP', 'GBPCAD', 'GBPCHF', 'GBPAUD', 'GBPUSD', 'GBPJPY', 'NZDCAD', 'NZDJPY', 'NZDUSD',
    'CADCHF', 'CADJPY', 'CHFJPY', 'USDCAD', 'USDCHF', 'USDJPY'
]

# Economic indicators to track
indicators = ['GDP', 'PMI', 'CPI', 'InterestRate', 'RetailSales', 'UnemploymentRate']

# Scoring system thresholds
scoring_thresholds = {
    'Very Bullish': 3,
    'Bullish': 2,
    'Neutral': 0,
    'Bearish': -2,
    'Very Bearish': -3
}

# Fetch live economic data
def fetch_economic_data(currency):
    response = requests.get(f"{BASE_URL}?currency={currency}&apikey={API_KEY}")
    if response.status_code == 200:
        return response.json()
    return {indicator: None for indicator in indicators}

# Fetch COT data
def fetch_cot_data(currency):
    response = requests.get(f"{COT_URL}?currency={currency}&apikey={API_KEY}")
    if response.status_code == 200:
        data = response.json()
        return data.get('long', 0), data.get('short', 0)
    return 0, 0

# Calculate economic score
def calculate_score(data):
    score = 0
    if data['GDP'] and data['GDP'] > 2.0: score += 1
    elif data['GDP'] and data['GDP'] < 1.0: score -= 1

    if data['PMI'] and data['PMI'] > 50: score += 1
    elif data['PMI'] and data['PMI'] < 45: score -= 1

    if data['CPI'] and data['CPI'] > 2.5: score += 1
    elif data['CPI'] and data['CPI'] < 1.0: score -= 1

    if data['InterestRate'] and data['InterestRate'] > 2.0: score += 1
    elif data['InterestRate'] and data['InterestRate'] < 0.5: score -= 1

    if data['RetailSales'] and data['RetailSales'] > 1.5: score += 1
    elif data['RetailSales'] and data['RetailSales'] < -0.5: score -= 1

    if data['UnemploymentRate'] and data['UnemploymentRate'] < 4.0: score += 1
    elif data['UnemploymentRate'] and data['UnemploymentRate'] > 6.0: score -= 1

    return score

# Map score to sentiment
def map_score_to_sentiment(score):
    if score >= scoring_thresholds['Very Bullish']:
        return 'Very Bullish'
    elif score >= scoring_thresholds['Bullish']:
        return 'Bullish'
    elif score <= scoring_thresholds['Very Bearish']:
        return 'Very Bearish'
    elif score <= scoring_thresholds['Bearish']:
        return 'Bearish'
    return 'Neutral'

# Generate data and scores
results = []
for pair in currency_pairs:
    base_currency, quote_currency = pair[:3], pair[3:]
    
    base_data = fetch_economic_data(base_currency)
    quote_data = fetch_economic_data(quote_currency)

    base_score = calculate_score(base_data)
    quote_score = calculate_score(quote_data)

    pair_score = base_score - quote_score
    sentiment = map_score_to_sentiment(pair_score)

    # Fetch COT data (for individual currencies)
    base_long, base_short = fetch_cot_data(base_currency)
    quote_long, quote_short = fetch_cot_data(quote_currency)

    results.append({
        'Currency Pair': pair,
        'Base Currency Long': base_long,
        'Base Currency Short': base_short,
        'Quote Currency Long': quote_long,
        'Quote Currency Short': quote_short,
        'Base Score': base_score,
        'Quote Score': quote_score,
        'Pair Score': pair_score,
        'Sentiment': sentiment
    })

# Create DataFrame and display
columns = [
    'Currency Pair', 'Base Currency Long', 'Base Currency Short', 'Quote Currency Long',
    'Quote Currency Short', 'Base Score', 'Quote Score', 'Pair Score', 'Sentiment'
]

df = pd.DataFrame(results, columns=columns)
print(df)

# Export to CSV
df.to_csv('forex_edge_dashboard.csv', index=False)
